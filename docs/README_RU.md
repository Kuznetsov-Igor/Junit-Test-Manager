# JUnit Test Manager Plugin

Этот плагин для IntelliJ IDEA упрощает управление и запуск JUnit-тестов, позволяя группировать их по профилям и регулярным выражениям, а также автоматизировать поиск и перемещение тестовых классов.

## Оглавление
- [Требования](#требования)
- [Расположение кнопок](#расположение-кнопок)
- [Расположение настроек](#расположение-настроек)
- [Настройки](#настройки)
    - [Профили](#профили)
    - [Группы](#группы) 
- [Настройки для генерации Test Data объектов](#настройки-для-генерации-test-data-объектов)
  - [Название класса для генерации Test Data объектов](#название-класса-для-генерации-test-data-объектов)
  - [Название метода для генерации Test Data объектов](#название-метода-для-генерации-test-data-объектов)
  - [Управление аннотациями](#управление-аннотациями)
  - [Управление генеративными методами](#управление-генеративными-методами)
- [Функционал](#функционал)
- [Окно результатов тестов](#окно-результатов-тестов)
- [Примеры](#примеры)
    - [Создание конфигураций для выбранных тестов](#создание-конфигураций-для-выбранных-тестов)
    - [Создание конфигураций для всех тестов или групп](#создание-конфигураций-для-всех-тестов-или-групп)
    - [Перемещение тестовых классов по пакетам](#перемещение-тестовых-классов-по-пакетам)
## Требования
- IntelliJ IDEA 2024.1 или выше
- Java 17 для runtime IntelliJ IDEA (версии 2024.1 и выше уже требуют и поддерживают эту версию)

## Расположение кнопок
Кнопки плагина доступны в контекстном меню при правом клике в редакторе кода или на панели проекта. Они сгруппированы под пунктом **JUnit Test Manager**.

![Расположение кнопок](images/1.png)

## Расположение настроек
Настройки плагина доступны в разделе **Settings** → **Tools** → **Test Manager Settings**.

![Расположение настроек](images/2.png)

## Настройки
В настройках доступны следующие опции:
- Управление группами
- Управление профилями
- Выбор языка интерфейса
- Флаг логирования

### Профили
Профили определяют, какие группы активны при группировке тестовых классов, а также влияют на аргументы VM и цветовое выделение.

![Профили](images/3.png)

### Группы
Группы отвечают за группировку тестовых классов при формировании конфигураций запуска и за определение аргументов VM для этих конфигураций. Группы позволяют автоматически присваивать тестовым классам категории на основе путей к файлам и применять специфические настройки запуска.

![Группы](images/4.png)

![Параметры группы](images/5.png)

У группы есть 4 параметра:
- **Наименование**: Название группы, отображаемое в интерфейсе плагина и в конфигурациях.
- **Регулярное выражение**: Определяет, к какой группе относится тест, на основе его пути в проекте. Например:
    - Если нужно выделить все конвертеры в группу `Convert` (известно, что они находятся в пакетах с `convert` в названии), используйте регулярное выражение `.*convert.*`. Теперь любой тест, у которого в пути встречается `convert`, будет автоматически отнесён к этой группе. Можно писать более сложные регулярные выражения — зависит от вашей фантазии.
    - Если regex не задан или не совпадает, тест попадает в группу по умолчанию `Default`. Regex поддерживает стандартный синтаксис Java (Pattern.compile).
- **Аргументы VM**: Аргументы виртуальной машины Java, с которыми будут запускаться тестовые классы данной группы. Например:
    - `-Dparallel.tests=true -Dthreads=4` — для параллельного выполнения тестов.
    - `-Xmx2g` — для увеличения размера heap, если тестовые классы требуют много памяти.
- **Цвет**: Цвет для визуального выделения группы в таблицах (ячейки окрашиваются в этот цвет). По умолчанию — серый. Помогает быстро различать группы в диалогах.
- **Профили**: Определяет, для каких профилей подходит данная группа; можно комбинировать их на случай разных проектов с похожими группами.

Группы можно добавлять, редактировать и удалять прямо из настроек. По умолчанию всегда есть группа `Default` (без regex и аргументов VM); её можно переопределить, создав свою без regex и привязав к профилю `Default`.


## Настройки для генерации Test Data объектов
![Настройки для генерации Test Data объектов](images/13.png)

Для вызова функционала, нужно перейти в сам объект, и на уровне класса вызвать контекстное меню, и выбрать пункт `Generate`>`Generate Test Data Object`.

![Настройки для генерации Test Data объектов](images/14.png)

В настройках доступны следующие опции:
- Название класса для генерации Test Data объектов
- Название метода для генерации Test Data объектов
- Управление аннотациями
- Управление генеративными методами

### Название класса для генерации Test Data объектов
Определяет префикс для создаваемого класса с Test Data объектами. По умолчанию будет выглядит так `public class ClassDataTestGenerator`.

### Название метода для генерации Test Data объектов
Определяет префикс для создаваемого метода с Test Data объектами. По умолчанию будет выглядит так `public static ClassObjectData generateClassDataTest()`

### Управление аннотациями
Позволяет добавлять, редактировать и удалять аннотации, которые будут использоваться при генерации Test Data объектов. Например, можно добавить аннотацию `@NonNull`, над методом, что бы точно понимать что мы тут генерируем объект не равный null. Так же позволяет указывать и над классом.
```java
@NoArgsConstructor(access = lombok.AccessLevel.PRIVATE)
public class ClassObjectDataGenerator {
    @NonNull
    public static ClassObjectData generateClassObjectData() {
        return new ClassObjectData(
                randomAlphabetic(20),
                randomAlphabetic(10),
                randomAlphabetic(10),
                randomAlphabetic(10)
        );
    }
}
```

#### Поля для добавления аннотаций
 - Указываем саму аннотацию (например `@NonNull`)
 - Указываем `import` для этой аннотации (например `import org.springframework.lang.NonNull`)
 - Указываем над чем будет добавлена аннотация: над классом (`CLASS`) или над методом (`METHOD`)

### Управление генеративными методами
Позволяет добавлять, и удалять генеративные методы, которые будут использоваться при генерации Test Data объектов. Например, можно добавить метод `randomAlphabetic(10)`, который будет генерировать случайную строку из букв определённой длины.

#### Поля для добавления генеративных методов
 - Указываем для какого типа объекта будет использоваться метод (например `java.lang.String`)
 - Указываем сам метод (например `randomAlphabetic(10)`)
 - Указываем `import` для этого метода (например `import static org.apache.commons.lang3.RandomStringUtils.randomAlphabetic`)

## Функционал
Тестовые классы определяются автоматически:
- Классы с аннотацией `@Test` (или `@ParameterizedTest` и подобными).
- Классы, наследующие от `junit.framework.TestCase`.
- Классы с именем, заканчивающимся на `Test`.

### 1. Find All Tests in Project
Находит **все** тестовые классы в проекте (рекурсивно по всем модулям и test source roots).

### 2. Find Tests in Changes
Находит тестовые классы, изменённые или добавленные. Для корректного отслеживания файлов рекомендуется подключить проект к Git, чтобы IDEA могла определить изменения.

### 3. Find Tests in Directory
Находит тестовые классы в выбранной директории (рекурсивно). Доступно только при правом клике на директорию в проекте.

### 4. Relocate Tests
Анализирует все классы в `src/main/java`, находит связанные тестовые классы в test source roots и проверяет соответствие пакетов:
- Тест должен быть в том же пакете, что и класс (например, `com.example.MyClass` → `com.example.MyClassTest`).
- Связь определяется по имени (`ClassName + "Test"`) и наличию импорта класса в тесте.
- Если пакеты не совпадают, предлагает переместить тест в пакет класса (с сохранением test source root). Показывает диалог с превью.

### 5. Relocate Changes Tests
Аналогично `Relocate Tests`, но анализирует только **изменённые** классы в main source roots.

**Примечание**:
- Для всех таблиц работает поиск и копирование.
    - Для функционала `Find Tests in Changes`, `Find All Tests in Project`, `Find Tests in Directory`: 
      - Поиск только по имени класса;
      - При копировании копируются только пути к классам с новой строки. Если не выбраны конкретные тестовые классы, конфигурация создастся для всех тестов по группам;
      - Если выбраны, то только для выбранных и по группам.
    - Для функционала `Relocate Tests`, `Relocate Changes Tests`: 
      - Поиск только по имени класса; 
      - При копировании копируется только наименование класса с новой строки;
      - Двойной клик на имени класса откроет файл в IDEA.

## Окно результатов тестов
После завершения запуска тестов IntelliJ IDEA отправляет события SMTRunner, которые перехватывает плагин. Итог отображается в отдельном окне `JUnit Test Manager Results` (`View` → `Tool Windows` → `JUnit Test Manager Results`). После выполнения тестов окно открывается автоматически и показывает актуальные данные:

- **Сводка по запуску.** В шапке видны общее время, количество успешных, предупреждающих и упавших тестов. Галочка *Show totals* управляет итоговыми строками по классам, а опция *Regressions only* оставляет только те тесты, у которых статус изменился относительно предыдущего запуска.
- **Фильтры статусов.** Отдельные чекбоксы позволяют скрывать/показывать успешные, предупреждающие, упавшие или проигнорированные тесты, чтобы сосредоточиться на нужных классах.
- **История по каждому тесту.** Сервис хранит предыдущий статус и лог каждого метода, поэтому регрессии сразу заметны и видно, что именно изменилось в выводе.
- **Навигация и логи.** Двойной клик по колонке с методом переводит вас в соответствующий тестовый метод (или в класс, если метод не найден). Клик по другим колонкам открывает логи: слева текущий запуск, справа — предыдущий для наглядного сравнения.
- **Нативная интеграция.** Слушатель работает через стандартные события SMTRunner, поэтому никаких дополнительных настроек не требуется — окно синхронизировано с обычным Run/Debug.
![15.png](images/15.png)

## Примеры
Для примеров используются простые настройки.

![Пример настроек](images/6.png)

### Создание конфигураций для выбранных тестов
- В настройках активен профиль `package1`;
- У группы указан regex `.*package1.*`.
- Как видно, определилась 1 наша группа и группа по умолчанию.

![Найденные тесты](images/7.png)

- Для примера выделены первые 2 класса, чтобы создать конфигурации только для них. В результате создались 2 конфигурации, и к одной из них применились аргументы, указанные для нашей группы.

![Созданные конфигурации](images/8.png)

### Создание конфигураций для всех тестов или групп
- Настройки.

![Настройки](images/9.png)

- Найденные тестовые классы.

![Найденные тесты](images/10.png)

- Наши конфигурации под каждую группу.

![Конфигурации](images/11.png)

**Примечание**: В тестовой конфигурации под одну группу может быть N тестовых классов, они указываются через Pattern.

### Перемещение тестовых классов по пакетам
Настройки те же, что и ранее, они не влияют на этот функционал. Мы анализируем файлы в main source root и ищем для них тестовые классы.
- У нас есть класс `NameClass2`, расположенный в `package2`, но мы решили его перенести в другой пакет, например, `package3`.
- Наш тест для этого класса остался в `package2`; он имеет корректное название `NameClass2Test` и в импортах есть ссылка на сам класс `NameClass2`, поэтому этот тестовый класс подходит для перемещения. Мы знаем, куда его стоит определить.

![Диалог перемещения](images/12.png)

- После перемещения тестовый класс будет размещён в `package3` только в test source root.

**Примечание**: Перемещаются только тестовые классы, для которых выбран чекбокс. По клику на заголовок `Selected` можно выбрать или снять все чекбоксы.

### В случае проблем
- **Regex не работает**: Убедитесь, что регулярное выражение соответствует синтаксису Java Pattern. Протестируйте его на примере путей к файлам.
- **Тесты не находятся**: Проверьте, что классы соответствуют критериям (аннотации, наследование или имя). Также убедитесь, что test source roots настроены корректно в проекте.
- **Перемещение сломало импорты**: В целом такого быть не должно, но если случилось то после перемещения вручную обновите импорты в тесте, если они не обновились автоматически.
- Если возникают другие проблемы, включите логирование в настройках плагина и проверьте логи для диагностики.
- **Не генерируются Test Data объекты**: Убедитесь, что вы вызываете генерацию на уровне класса и что класс содержит поля для генерации. Проверьте настройки генерации и убедитесь, что необходимые аннотации и методы указаны правильно. Так же может быть ошибка из-за индексации проекта, и плагин просто не видит в каком пакете нужно генерировать Test Data объекты. Самое быстрое решение создать данный пакет и выполнить команду заново.

### Содействие
- Если у вас есть идеи по улучшению плагина или вы хотите сообщить об ошибке, пожалуйста, создайте [issue](https://github.com/Kuznetsov-Igor/Junit-Test-Manager/issues)
- Помощь в развитии приветствуются! Вы всегда можете создать pull request с улучшениями или новыми функциями.

### Протестировано на
Протестировано:
- Ubuntu 20.04.6 LTS
  - IntelliJ IDEA 2024.1.6 (Community Edition) Runtime version: 17.0.11+1-b1207.30 amd64, VM: OpenJDK 64-Bit Server VM by JetBrains s.r.o.
  - IntelliJ IDEA 2025.2.3 (Community Edition) Runtime version: 21.0.8+9-b1038.72 amd64 (JCEF 122.1.9) VM: OpenJDK 64-Bit Server VM by JetBrains s.r.o.
- Windows 10 Pro 22H2 19045.6456
  - IntelliJ IDEA 2024.1.4 (Ultimate Edition), Runtime version: 17.0.11+1-b1207.24 amd64 , VM: OpenJDK 64-Bit Server VM by JetBrains s.r.o.